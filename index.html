<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Game Dependency Viewer</title>
  <link rel="stylesheet" href="./style.css" />
</head>
<body>
  <div class="container">
    <h1>Game Dependency Viewer</h1>
    <input class="big-blue-search" type="text" id="search" placeholder="Search for a game..." />
    <div id="gameList"></div>
  </div>

<script>
  let games = [];

  async function loadGames() {
    const res = await fetch('https://raw.githubusercontent.com/stuffbymax/game-dependencies-db/main/games.json');
    games = await res.json();
    displayGames(games);
  }

  function displayGames(gameArray) {
    const container = document.getElementById('gameList');
    container.innerHTML = '';

    gameArray.forEach(game => {
      const div = document.createElement('div');
      div.className = 'game';

      div.innerHTML = `
        <img src="${game.image || 'https://via.placeholder.com/150?text=No+Image'}" alt="${game.name} image" />
        <div class="game-info">
          <h2>${game.name}</h2>
          <button onclick="toggleDetails(this)">Show Details</button>
          <div class="details">
            <p><strong>DirectX:</strong> ${game.directx}</p>
            <p><strong>VC++:</strong> ${game.vcredist.join(', ')}</p>
            <p><strong>.NET:</strong> ${game.dotnet}</p>
            <p><strong>Missing DLLs:</strong> ${game.dlls.join(', ')}</p>
            <p><strong>Fixes:</strong></p>
            <ul>${game.fixes.map(fix => `<li>${fix}</li>`).join('')}</ul>
            <p><strong>Download Links:</strong></p>
            <ul>
              <li><a href="${game.downloads.directx}" target="_blank" rel="noopener noreferrer">DirectX</a></li>
              ${Object.entries(game.downloads.vcredist).map(([year, url]) => `<li><a href="${url}" target="_blank" rel="noopener noreferrer">VC++ ${year}</a></li>`).join('')}
              <li><a href="${game.downloads.dotnet}" target="_blank" rel="noopener noreferrer">.NET Framework</a></li>
            </ul>
          </div>
        </div>
      `;
      container.appendChild(div);
    });
  }

  function toggleDetails(button) {
    const details = button.nextElementSibling;
    details.classList.toggle('show');
    button.textContent = details.classList.contains('show') ? 'Hide Details' : 'Show Details';
  }

  document.getElementById('search').addEventListener('input', function () {
    const query = this.value.toLowerCase();
    const filtered = games.filter(g => g.name.toLowerCase().includes(query));
    displayGames(filtered);
  });

  loadGames();
</script>
</body>
